<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name=viewport content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no'>
    <title>推推</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/element-ui.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/iconfont.css">
  </head>
  <body>
    <div id="app" v-cloak >
        <div class="h30"></div>
        <div class="main_head">
            <h3>今日收益</h3>
            <big>{{number[0]}}</big>
            <h3>累计收益<span>{{number[1]}}</span>元　｜　可用余额<span>{{number[2]}}</span>元</h3>
            <a href="my.html" class="mine"><i class="iconfont icon-touxiang"></i></a>
        </div>
        <hr class="line10">
        <ul class="task_list main2_list">
            <li v-for="item in list">
                <a :href="item.url">
                    <lock-div :bg="item.img" class="left"></lock-div>
                    <div class="right">
                        <div class="txt">{{item.txt}}</div>
                        <div class="bar">
                            <span>剩余：{{item.number}}</span>
                            
                        </div>
                    </div>
                </a>
                <a href="#" class="btn4" :class="[item.type?'main2_active1':'main2_active2']"><el-button type="text" @click="open2(item.type)">{{item.option}}</el-button></a>
            </li>
        </ul>
        <infinite-loading  :on-infinite="onInfinite" ref="infiniteLoading">
            <span slot="no-results">- 没有更多了 -</span>
            <span slot="no-more">已经到末尾</span>
        </infinite-loading>
        <div class="h30"></div>
    </div>
  </body>
</html>

<script src="js/vue2.js"></script>
<script src="js/element-ui.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/vue-resource.js"></script>
<script src="js/common.js"></script>
<script src="js/vue-infinite-loading.js"></script>
<script>
    const AJAX_PATH = "mocks/main2.json";       
    var vm = new Vue({
      el: '#app',
      data: {
        number:[12.00,38.00,12.00],
        list:[
            {
            url:"detail.html",
            img:'images/b1.jpg',
            txt:'托福：通向美好未来，需要的不只是许可，而是能力',
            number:'3200',
            option:'抢任务',
            type:1,
        },{
            url:"detail.html",
            img:'images/b2.jpg',
            txt:'金立携手达康书记，以#安全的名义#…',
            number:'3200',
            option:'抢任务',
            type:1,
        },{
            url:"detail.html",
            img:'images/b1.jpg',
            txt:'托福：通向美好未来，需要的不只是许可，而是能力',
            number:'0',
            option:'已结束',
            type:0,
        },{
            url:"detail.html",
            img:'images/b1.jpg',
            txt:'托福：通向美好未来，需要的不只是许可，而是能力',
            number:'0',
            option:'已结束',
            type:0,
        },{
            url:"detail.html",
            img:'images/b2.jpg',
            txt:'金立携手达康书记，以#安全的名义#…',
            number:'3200',
            option:'抢任务',
            type:1,
        },
    ],
    
  },
  
  methods: {
        
        open2:function(e) {
            if (e==1) {
                this.$confirm('确定领取任务?', '提示', {
                  confirmButtonText: '确定',
                  cancelButtonText: '取消',
                  type: 'warning'
                }).then(() => {
                  this.$message({
                    type: 'success',
                    message: '领取成功!'
                  });
                }).catch(() => {
                  this.$message({
                    type: 'info',
                    message: '已取消'
                  });          
                });
            } else {
                return
            }
        
      },


        onInfinite:function () {
            setTimeout(function() {
                
                var call = this.$http({
                      method:'GET',
                      url:AJAX_PATH
                      });

                call.then(function (e) {
                    if(e.body.errno===0){
                        this.list = this.list.concat(e.body.list);
                        // 继续载入
                        this.$refs.infiniteLoading.$emit('$InfiniteLoading:loaded');
                    }else{
                        // 结束载入 (末页)
                        this.$refs.infiniteLoading.$emit('$InfiniteLoading:complete');
                    }
                    
                });
            }.bind(this), 500);
        }
    }




})



</script>